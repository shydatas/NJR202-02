[core]
# ====== 核心設定 ======
# DAG 檔案存放目錄
dags_folder = /opt/airflow/dags

# 插件存放目錄
plugins_folder = /opt/airflow/plugins

# 資料庫連線字串 (這裡會被 docker-compose 的環境變數覆蓋)
sql_alchemy_conn = sqlite:////opt/airflow/airflow.db

# 執行器類型: LocalExecutor(單機), CeleryExecutor(分散式)
executor = LocalExecutor

# 是否載入 Airflow 內建的範例 DAG (建議關閉)
load_examples = False

# 同時可執行的 DAG 數量上限
max_active_runs_per_dag = 3

# 整個 Airflow 實例同時可執行的 Task 數量上限
parallelism = 16

# 單一 DAG 同時可執行的 Task 數量上限
max_active_tasks_per_dag = 8

# 時區設定 (建議使用 UTC)
default_timezone = Asia/Taipei

[scheduler]
# ====== 排程器設定 ======
# 排程器檢查新任務的間隔時間 (秒)
scheduler_heartbeat_sec = 5

# 掃描 DAG 檔案變更的間隔時間 (秒)
dag_dir_list_interval = 300

# 排程器最多執行幾輪 (-1 表示無限制)
num_runs = -1

# 預設不啟用 catchup (避免歷史任務大量執行)
catchup_by_default = False

[webserver]
# ====== Web 介面設定 ======
# Web 服務綁定的 IP 位址 (0.0.0.0 表示接受所有來源)
web_server_host = 0.0.0.0

# Web 服務的埠號
web_server_port = 8080

# Web 伺服器的秘密金鑰 (生產環境請更換)
secret_key = your-secret-key-here

# 是否需要登入驗證 (開發階段可設為 False)
authenticate = False

# 是否在 Web 介面顯示設定檔內容
expose_config = True

[logging]
# ====== 日誌設定 ======
# 日誌檔案存放目錄
base_log_folder = /opt/airflow/logs

# 日誌等級: DEBUG, INFO, WARNING, ERROR
logging_level = INFO

# Flask-AppBuilder 日誌等級
fab_logging_level = WARNING

# 日誌格式 (更清楚的格式) - 需要轉義 % 符號
log_format = [%%(asctime)s] %%(levelname)s - %%(filename)s:%%(lineno)d - %%(funcName)s() - %%(message)s

# 簡化日誌格式 (用於某些地方)
simple_log_format = %%(asctime)s %%(levelname)s - %%(message)s

# 日誌檔案命名格式 (依 DAG/Task/執行時間分類)
log_filename_template = dag_id={{ ti.dag_id }}/run_id={{ ti.run_id }}/task_id={{ ti.task_id }}/attempt={{ try_number }}.log

# DAG 處理器日誌檔案格式
log_processor_filename_template = {{ filename }}.log